---
{"dg-publish":true,"permalink":"/06-full-notes/it-4-stp/","noteIcon":""}
---

[[03 - Tags/IT Engineer를 위한 네트워크\|IT Engineer를 위한 네트워크]]

# 단서 질문
- SPoF란?
    단일 요소로 인해 전체 서비스가 중단되는 지점
- 루프란?
    네트워크에 환형 형태에 연결이 발생하여 패킷이 순환하는 상태
- 루프를 야기하는 전송 방식
    브로드캐스팅 스톰
    맥 주소 플래핑
# 핵심 요약
- SPoF는 단일 요소로 인해 전체 시스템이 마비되는 지점이다.

# 핵심 필기
SPoF(Single Point of Failure) 단일 요소로 인해 전체 시스템이 마비되는 현상을 말합니다. 
네트워크로 치면 ISP↔게이트웨이↔방화벽↔스위치↔노드로 연결되어 있는데 이 중에 단 1개의 요소라도 끊기면 전체 네트워크가 마비됩니다. 
스위치 구간에서 이러한 문제를 예방하기 위해서 스위치의 개수를 늘리는 방식을 사용합니다. 그러나, 이러한 방법 또한 **루프(loop)**라는 문제를 야기할 수 있습니다. 
루프란 동일한 패킷이 내부 네트워크를 계속 순회하면서 전체 스위치의 속도가 저하되며 마비가 되는 것을 말합니다. 이러한 루프는 스위치의 구조가 환형대기일 때, 주로 발생합니다.

## **루프를 야기하는 전송 방식**
### 브로드캐스트 스톰
1. 브로드캐스트 스톰은 스위치에서 브로드캐스트 요청을 받으면 해당 패킷을 모든 포트로 전송합니다. 
2. 전송을 받은 스위치에선 자신과 연결된 포트로 브로드캐스팅을 실시합니다. 
3. 그러나, 먼저 송신한 스위치와 수신한 스위치가 포트로 연결되어 있기 때문에 브로드캐스팅의 반복이 발생합니다. 이를 브로드캐스트 스톰이라고 합니다.

### MAC 어드레스 플래핑
ARP 요청을 할 때, 송신자의 MAC 주소를 통해서 몇 번 포트와 노드가 연결 되었는지 학습했다는 내용을 배웠습니다. 만약, 네트워크가 환형 구조를 가진다면 어떻게 될까요?

스위치 A에서 브로드캐스팅을 합니다. 스위치 A와 연결된 스위치 B에 속한 노드는 자신이 여기있다며 패킷을 다시 전송합니다. 그러나, 스위치 B는 스위치 C와도 연결되어 있어 스위치 C에도 ARP에 대한 응답을 합니다. 따라서, 스위치 B와 스위치 C 모두에서 ARP에 대한 응답이 옵니다. 포트 1번이 스위치 B이고 포트 2번이 스위치 C라면 해당 MAC 주소와 매핑되는 포트는 1,2로 중복이 됩니다.

![Untitled 29.png](/img/user/image/Untitled%2029.png)
이를 방지하는 극단적인 방법으론 루프 네트워크 자체를 제거하는 방식이 있습니다. 환형대기가 발생하지 않도록 스위치 간 연결을 끊는 것입니다. 그러나, 이는 SPoF를 방지하고자 시작한 네트워크의 이중화를 막는 느낌이 듭니다.
따라서, 이를 해결하기 위해 STF(Spanning Tree Protocol)이 등장했습니다.

## **STF(Spanning Tree Protocol)**
말 그대로 뻦은 나무 프로토콜답게 루프를 방지하는 프로토콜입니다. BPDU(Bridge Protocol Data Unit)을 전송하여 스위치 간에 연결 관계를 파악하고 만약, 루프가 발생한다면 해당 가지를 끊어버립니다.
