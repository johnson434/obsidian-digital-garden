---
{"dg-publish":true,"dg-permalink":"system-design/book/system-design-interview-1/chapter02","permalink":"/system-design/book/system-design-interview-1/chapter02/","noteIcon":""}
---

# Tags
[[03 - Tags/가상 면접 사례로 배우는 대규모 시스템 설계 기초 1권\|가상 면접 사례로 배우는 대규모 시스템 설계 기초 1권]]

---
# 단서 질문
- 개략적인 규모 추정(back-of-the-envelope esti-mation)? 
	- 보편적으로 통용되는 수치상에서 사고 실험(thought experiments)를 통해서 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것
- QPS란?
	- Query Per Second로 초당 들어오는 쿼리 개수를 의미합니다.
---
# 핵심 요약
- 개략적인 규모 측정은 통상적인 수치를 통해 시스템 구조를 설계하는 것이다.
- 이를 위해선 데이터 규모 계산과 응답 지연 시간에 대한 개념을 가져야 한다.
---
# 핵심 필기
## 개요
- 개략적인 규모 측정이란(back-of-the-envelope esti-mation) 보편적으로 통용되는 수치상에서 사고 실험을 통해서 설계의 방향성을 잡아가는 것
- 개략적인 규모 측정을 위해선 `2의 제곱수`, `응답 지연(latency) 값`, 그리고 `가용성`에 관계된 수치들을 잘 이해하고 있어야 한다.
## 2의 제곱 수
- 데이터의 크기를 계산할 줄 알아야 대략적인 수치를 계산 가능하다.
- 2의 제곱 수라고 표현해서 엄청 어려운 개념처럼 보이지만 사실 비트 표현식이 끝이다
 ![Pasted image 20250118125925.png](/img/user/image/Pasted%20image%2020250118125925.png)
## 모든 프로그래머가 알아야 하는 응답지연 값
| 연산명                            | 시간                  |
| ------------------------------ | ------------------- |
| L1 캐시 참조                       | 0.5ns               |
| 분기 예측 오류                       | 5ns                 |
| L2 캐시 참조                       | 7ns                 |
| 뮤텍스 락/언락                       | 100ns               |
| 주 메모리 참조                       | 100ns               |
| Zippy로 1KB 압축                  | 10,000ns=10us       |
| 1 Gbps 네트워크로 2KB 전송            | 20,000ns=20us       |
| 메모리에서 1 MB 순차적으로 read          | 250,000ns=250us     |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간     | 500,000ns=500us     |
| 디스크 탐색                         | 10,000,000ns=10ms   |
| 네트워크에서 1 MB 순차적으로 read         | 10,000,000ns=10ms   |
| 디스크에서 1 MB 순착적으로 read          | 30,000,000ns=30ms   |
| 한 패킷의 캘리포니아로부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns=150ms |
- 위에 수치를 분석하면 다음과 같은 결론을 낼 수 있다.
	- 메모리는 빠르지만 디스크는 느리다. (주기억장치, 보조기억장치)
	- 디스크 탐색(seek)는 최대한 피하라
	- 단순한 압축 알고리즘은 빠르다.
	- 데이터를 압축하고 보내라.
	- 데이터 센터는 여러 지역에 분산 되어 있고, 센터들 간에 데이터를 주고 받는 데는 시간이 걸린다.

> [!초 단위]
> 나노초: 10^-9
마이크로초: 10^-6
밀리초: 10^-3
## 가용성에 관련된 수치들
- 가용성이란 서비스가 중단되지 않고 동작을 보장하는 시간입니다. 예를 들어, 한 번도 중단되지 않는 서비스는 100%의 가용성을 가졌다고 말합니다.
- SLA(Service Level Aggrement)는 서비스 제공자와 고객 사이에서 맺어진 합의를 말합니다. 이 합의에는 가용시간(uptime)이 공식적으로 기술되어 있습니다.

| 가용률      | 하루당 장애시간  | 주당 장애시간   | 개월당 장애시간 | 연간 장애시간 |
| -------- | --------- | --------- | -------- | ------- |
| 99%      | 14.40분    | 1.68시간    | 7.31시간   | 3.65일   |
| 99.9%    | 1.44분     | 10.08분    | 43.83분   | 8.77시간  |
| 99.99%   | 8.64초     | 1.01분     | 4.38분    | 52.60분  |
| 99.999%  | 864.00밀리초 | 6.05초     | 26.30초   | 5.26분   |
| 99.9999% | 86.40밀리초  | 604.80밀리초 | 2.63초    | 31.56초  |
## 예제: 트위터 QPS(Query Per Second)와 저장소 요구량 추정
- 아래 제시된 수치들은 가상의 데이터로 실제 트위터 서비스의 데이터가 아닙니다.
- **가정**
	- MAU(Monthly Active User: 월간 활성 사용자)는 3억
	- 월간 사용자 중의 50% 사용자가 트위터를 매일 사용한다.
	- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
	- 미디어를 포함하는 트윗은 10%정도다.
	- 데이터는 5년간 보관된다.
	- 트윗 평균 수치
		- tweet_id에 64바이트
		- 텍스트에 140바이트
		- 미디어에 1MB
- **추정**
	- QPS 추정치
		- **DAU:** (3억 * 0.5) = 1.5억
		- **하루에 올라오는 트윗 개수:** `DAU * 인당 트윗 개수 = 3억`
			- `하루에 발생하는 쿼리 개수 = 3억`
		- **초당 발생하는 쿼리 개수** = `하루에 발생하는 쿼리 개수 / 24시간 = 3억 / (24 * 60 * 60) = 약 3,500`
		- **최대 QPS(Peek QPS)**: 피크 시간 접속자 수가 평균 접속자 수에 2배라고 가정했을 때, `2 * QPS = 약 7,000`
	- 미디어 저장을 위한 저장소 요구량
		- **하루 평균 트윗 개수**: 3억
		- **하루 미디어 트윗 개수**: 3,000만
		- **하루 올라오는 데이터량**: `하루 미디어 트윗 개수 * 1MB = 30,000,000 * 1MB = 30TB`
		- **1년동안 미디어를 보관하기 위한 저장소 요구량** = `30TB * 365 = 10.95PB === 11PB`
	- 개략적 규모 추정 문제로는 다음과 같은 내용들이 자주 질문된다.
		- QPS
		- 최대 QPS
		- 저장소 요구량
		- 캐시 요구량
		- 서버 수

---
# 참고 자료
**지연 시간**
https://colin-scott.github.io/personal_website/research/interactive_latency.html




