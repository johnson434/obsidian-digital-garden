---
{"dg-publish":true,"permalink":"/06-full-notes/linux-system-call/","noteIcon":""}
---

# Tags
- [[03 - Tags/Linux\|Linux]]
---
# 핵심 요약
- 시스템 호출은 System Call Interface를 통해 이뤄진다.
- 시스템 호출엔 실행할 명령어 번호와 매개변수가 넘어간다.
- 유저 프로세스는 시스템 호출 인터페이스에 이들을 넘기고, 커널 모드로 전환 후에 커널 모드에서 해당 연산을 실행 후에 결과 값을 반환 받는다.
- User Application은 해당 인터페이스를 통해 시스템 호출을 한다.(실행할 명령어와 파라미터를 넘긴다.)
---
# 핵심 필기
## 리눅스의 시스템 호출
**시스템 호출**은 커널이 User application에 제공하는 서비스다.
시스템 호출은 파라미터명, 매개변수, 반환값을 가지고 있다는 점에서 함수와 비슷하다.
시스템 호출은 실제론 함수 호출이 아니라 다음과 같은 작업을 하는 어셈블리 명령어다.
- 시스템 호출이 무엇을 할지 정의하고, 파라미터를 정의한다.
- 커널 모드로 전환한다.
- 시스템 호출로 작업한 내용을 반환한다.
즉, 시스템 호출은 숫자(무슨 명령어를 실행할지)와 파라미터(워드 사이즈 크기)로 구성된다. 파라미터 개수는 최대 6개다.
해당 숫자가 무슨 명령어를 실행할지는 레지스터에 저장되어 있다. 
## 시스템 호출의 실행 흐름
- 유저 어플리케이션에서 시스템 호출 번호와 파라미터를 전송한다.
- 프로세스가 유저 모드에서 커널 모드로 전환된다. CPU도 커널 스택으로 전환하며 유저 스택과 돌아갈 유저 공간 주소가 커널 스택에 저장된다.
- 커널 진입점은 커널 스택에 레지스터에 저장된다.
- 시스템 호출 디스패처에서 시스템 호출의 번호를 보고 이를 통해 명령어를 실행한다.
- 유저 공간 레지스터가 복구되며 실행모드가 유저 모드로 올아온다.
- 유저 공간 어플리케이션이 실행을 재개한다.
> [! 커널 스택, 유저 스택]
> 커널 스택이란 게 무슨 소리인가 헷갈렸는데. 프로세스별로 실행의 흐름을 저장하는 영역이 있음을 알 것이다.(유저 스택은 흔히 우리가 코드, 스택, 힙, 데이터 영역 얘기할 때 그 스택 영역) 여기에 추가로 해당 프로세스가 커널 모드에서 실행할 흐름을 저장하는 커널 스택 영역이 존재한다. 스택 영역에서 지역 변수와 함수의 실행 결과를 저장하듯이 해당 프로세스가 커널에서 실행하는 결과를 저장하고 있다. 애초에 커널은 프로세스가 아니라 운영체제의 일부라고 소개한다. 

![Pasted image 20250217100246.png](/img/user/image/Pasted%20image%2020250217100246.png)
위 그림을 보면 커널 영역 내부엔 커널 스택이 존재하며 해당 프로세스가 커널 모드로 실행됐을 때, 스택 영역 역할을 한다. 
밑에는 상세한 코드 구현 파트라 커널 개발에 더 가까운 내용이라 스킵(시스템 호출 파라미터로 커널 메모리 주소를 가리킨다면 호출을 받으면 안된다 이런 내용)

---
# 참고 자료
https://linux-kernel-labs.github.io/refs/heads/master/so2/lec2-syscalls.html#so2-lecture-02-system-calls